description: "Instructions for the exploras-agent workflow (generic AI agent for any epub with TOC)"
applyTo: [src/agent/generate_post.py, .github/workflows/epub-knowledge-agent.yml]
---


## Mission

Automate the generation and publishing of articles and answers using AI and content from any epub file (with TOC) stored in the `ebook` folder. The user interacts via a web UI (frontend/ui) to ask questions about the book. The Python backend extracts context from the epub and generates answers using AI.


## Detailed Workflow

1. **User interaction via UI:**  
   The user asks a question through the web UI (frontend/ui).
2. **Backend processing:**  
   The Python backend receives the question, extracts context from the epub, and generates an answer using AI (GPT-4o).
3. **Chatmode selection:**  
   The backend loads the appropriate chatmode file (default: `.github/chatmodes/oldbirba.chatmode.md`). This file defines the system prompt, style, and tone for the AI, allowing for persona and style customization.
4. **AI call:**  
   The backend uses the loaded system prompt and the user's question to generate a response with GPT-4o. API keys are always loaded from environment variables or secrets for security.
5. **Output formatting:**  
   The AI response is structured as a Markdown article/answer, including front matter (title, date, tags, etc.) if needed. Always ends with a call to action.
6. **Save or publish:**  
   The output can be saved in the `output/` folder as a timestamped `.md` file, displayed in the UI, or published to WordPress via REST API.
7. **(Optional) HTML conversion:**  
   If required, provides a function to convert Markdown to HTML.
8. **Stub: WordPress publishing:**  
   Includes a stub function for posting the article to WordPress via REST API, with parameters for authentication and draft/publish status.
9. **Logging and error handling:**  
   Logs each major step. Handles API errors with retries and notifications.
10. **Testing:**  
   Automated tests (`test_generate_post.py`) simulate the full process end-to-end.


## Constraints

- No secrets or API keys in code; always use environment variables or GitHub secrets.
- All outputs must be clear, well-structured, and end with a call to action.
- Robust error handling; if the AI fails, log, retry, or notify the admin.
- The entire repository is generated by AI under human instructions.


## Personalization

- To change the writing style or persona, edit or add `.chatmode.md` files in `.github/chatmodes/`.
- Update workflows or scripts to support new personas or output formats.
